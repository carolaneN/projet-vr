<html>
<head>
  <meta charset="utf-8" />
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
  <script src="./dist/aframe-extras.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@3.0.3/dist/aframe-event-set-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/kylebakerio/ada-water/ada-water.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <title>Projet 3D</title>
</head>
<body>
  <a-scene generate-houses generate-trees>
    <a-assets>
      <img id="sky" src="./assets/sky.png" alt="" />
      <img id="ville" src="./assets/aerial-view.jpg" alt="">
      <img id="ground" src="./assets/ground/grass_02_base_2k.png" alt="">
      <img id="groundNormal" src="./assets/ground/grass_02_normal_dx_2k.png" alt="">

      <audio id="extrait_paint" src="./assets/extrait_peinture.mp3" preload="auto"></audio>
      <audio id="extrait_velo" src="./assets/extrait v√©lo.mp3" preload="auto"></audio>
      <audio id="extrait_aeronef" src="./assets/extrait_aeronef.mp3" preload="auto"></audio>

      <a-asset-item id="aeronef" src="./assets/airship_spirit_of_adventure.glb"></a-asset-item>
      <a-asset-item id="broom" src="./assets/broom.glb"></a-asset-item>
      <a-asset-item id="jiji" src="./assets/jiji.glb"></a-asset-item>
      <a-asset-item id="cloud" src="./assets/cloud_high_poly.glb"></a-asset-item>
      <a-asset-item id="tower" src="./assets/newmarket_suffolk_uk_-_jubilee_clock_tower.glb"></a-asset-item>
      <a-asset-item id="seagull" src="./assets/seagull.glb"></a-asset-item>
      <a-asset-item id="house1" src="./assets/house_1.glb"></a-asset-item>
      <a-asset-item id="house2" src="./assets/house_2.glb"></a-asset-item>
      <a-asset-item id="tree" src="./assets/oak_tree__game_ready.glb"></a-asset-item>
      <a-asset-item id="package" src="./assets/grungy_brown_package.glb"></a-asset-item>
      <a-asset-item id="girl" src="./assets/stylized_girl_heynerdtm.glb"></a-asset-item>
      <a-asset-item id="crow" src="./assets/low_poly_crow.glb"></a-asset-item>
      <a-asset-item id="painting" src="./assets/painting_lowpoly.glb"></a-asset-item>
      <a-asset-item id="velo" src="./assets/bycicle_ussr.glb"></a-asset-item>
    </a-assets>

    <!-- <a-camera position="0 0 0"></a-camera> -->
    

    <a-entity  id="rig" movement-controls="speed: 0.8" position="0  1 -25" >
      <a-entity camera look-controls wasd-controls position="0 1 26"></a-entity>


      <a-entity
          laser-controls="hand: left"
          raycaster="objects: .clickable; far: 20; showLine: true"
          position="-0.5 1.5 -2"
        ></a-entity>
        <a-entity
          laser-controls="hand: right"
          raycaster="objects: .clickable; far: 20; showLine: true"
          position="0.5 1.5 -2"
        ></a-entity>

                <!-- <a-cursor></a-cursor> -->
                <a-sound src="./assets/seagull.mp3" autoplay="true" volume=".8" loop="true"></a-sound>
                <a-sound src="./assets/ost_town_with_ocean_view.mp3" autoplay="true" loop="true"></a-sound>
                <a-sound src="./assets/airship.mp3" autoplay="true" volume="1"></a-sound>
                <a-sound src="./assets/extrait v√©lo.mp3" autoplay="false"></a-sound>
                <a-sound src="./assets/extrait_peinture.mp3" autoplay="false"></a-sound>
        
                <a-entity position="0 .1 0">
                  <a-text value="Allons livrer ce colis pour la jeune fille de la tour !" color="#000000"  position="0 1.5 -2" animation="property: opacity; to: 0; dur: 1; delay: 10000 ; easing: linear"></a-text>

                  <a-text value="Mais c'est l'engin de notre ami ! Que fait-il aussi haut dans le ciel ?" id="afterBycicle" color="#000000"  position="0 1.5 -2" visible="false" animation="property: opacity; to: 0; dur: 1; delay: 10000 ; easing: linear"></a-text>

                  <a-entity gltf-model="#jiji" scale=".1 .1 .1" position="0 .4 -1.5"></a-entity>
                  <a-entity gltf-model="#package" scale=".5 .5 .5" position="0 .5 -2.5" rotation="0 90 0"
                  class="clickable" id="pack" cursor-listener visible="true"></a-entity>
                  <a-entity gltf-model="#broom" scale="4 4 4" rotation="-80 0 0"></a-entity>
                </a-entity>
        
                <a-entity position="0 1 -8">
                  <a-entity gltf-model="#seagull" animation-mixer loop="repeat" duration="1000" scale="1 1 1" position="-3 -1 0" rotation="0 -90 0"></a-entity>
          
                <a-entity gltf-model="#seagull" animation-mixer loop="repeat" duration="1000" scale="1 1 1" position="-5 -1 2" rotation="0 -90 0"></a-entity>
          
                <a-entity gltf-model="#seagull" animation-mixer loop="repeat" duration="1000" scale="1 1 1" position="-7 -1 4" rotation="0 -90 0"></a-entity>
          
                <a-entity gltf-model="#seagull" animation-mixer loop="repeat" duration="1000" scale="1 1 1" position="3 -1 0" rotation="0 -90 0"></a-entity>
                
                <a-entity gltf-model="#seagull" animation-mixer loop="rapeat" duration="1000" scale="1 1 1" position="5 -1 2" rotation="0 -90 0"></a-entity>
          
                <a-entity gltf-model="#seagull" animation-mixer loop="repeat" duration="1000" scale="1 1 1" position="7 -1 4" rotation="0 -90 0"></a-entity>
                </a-entity>
    </a-entity>


    <a-entity position="-200 85 -140" animation="property:position; to: 180 -10 -140; dur: 25000; easing: linear;">
      <a-entity gltf-model="#aeronef" scale="10 10 10" position="0 0 0" rotation="0 90 0"></a-entity>

      <a-entity geometry="primitive:plane; width:.5; height:.5" position="-50 10 12" scale="5 5 5" class="clickable" sound="src: #extrait_aeronef; on: click; volume: 12; positional: false"></a-entity>
    </a-entity>

      <a-entity gltf-model="#cloud" scale="40 40 40" position="-400 80 -120" rotation="0 0 0"></a-entity>

      <a-entity gltf-model="#cloud" scale="40 40 40" position="35 15 -120" rotation="0 0 0"></a-entity>

      <a-text value="Super, merci ! Peux-tu apporter cette peinture au corbeau non loin ?" color="#fff" id="thanks" position="52 5 -119" rotation="0 -90 0" visible="false"></a-text>

      <a-entity gltf-model="#girl" scale="1 1 1" position="53.5 2 -119" rotation="0 -90 0"></a-entity>

      <a-entity gltf-model="#painting" id="paints" scale="1 1 1" position="53 2 -121" rotation="0 -90 0" class="clickable" painting-listener visible="true" sound="src: #extrait_paint; on: click; volume: 12; positional: false"></a-entity>

      <a-text value="Merci ! J'ai vu une byciclette non loin ? Comment est-ce possible ? Vous devriez aller voir !" color="#000000" id="croa" position="63.5 2 -109" rotation="0 0 0" visible="false"></a-text>

      <a-entity gltf-model="#crow" scale=".05 .05 .05" position="63 1 -112" rotation="0 0 0" id="raven" class="clickable" paintingdelivered-listener visible="true"></a-entity>

      <a-entity gltf-model="#painting" id="paintDelivered" scale="1 1 1" position="60 2 -112" rotation="0 0 0" visible="false" ></a-entity>

      <a-entity gltf-model="#velo" scale=".3 .3 .3" position="69 2.4 -120" rotation="0 90 0" id="velo" class="clickable" bycicle-listener visible="true" sound="src: #extrait_velo; on: click; volume: 21; positional: false"></a-entity>

      <a-entity gltf-model="#package" scale=".5 .5 .5" position="53.5 4 -119" rotation="0 90 0"
           id="pack2" cursor-listener visible="false"></a-entity>

      <a-entity gltf-model="#tower" scale="6.5 6.5 6.5" position="60 10 -120"></a-entity>

      <a-entity geometry="primitive:plane; width:232; height:174" position="0 -40 -30" rotation="-90 90 0" material="src: #ground; normalMap: #groundNormal">
      </a-entity>

      <a-water width="1000" length="1000" position="0 -41 -30" base-color="lightblue"></a-water>

      <a-sky src="#sky"></a-sky>
  </a-scene>

  <script>

AFRAME.registerComponent("generate-houses", {
  init: function () {
    const models = ["#house1", "#house2"];
    const planeWidth = 174;
    const planeHeight = 232;
    const numHouses = 40; 

    for (let i = 0; i < numHouses; i++) {
      const house = document.createElement("a-entity");
      const randomModel = models[Math.floor(Math.random() * models.length)];

      x = Math.random() * (planeWidth - 10) - (planeWidth / 2 - 5);
        z = Math.random() * (planeHeight / 2) - (planeHeight / 2);
      
      house.setAttribute("position", {
        x: x,
        y: -40,
        z: z
      });

      house.setAttribute("rotation", `0 ${Math.random() * 360} 0`);
      house.setAttribute("scale", "3 3 3");
      house.setAttribute("gltf-model", randomModel);

      this.el.appendChild(house);
    }
  }
});

AFRAME.registerComponent("generate-trees", {
  init: function () {
    const models = ["#tree"];
    const planeWidth = 174;
    const planeHeight = 232;
    const numTrees = 8; 

    for (let i = 0; i < numTrees; i++) {
      const tree = document.createElement("a-entity");
      const randomModel = models[Math.floor(Math.random() * models.length)];

      x = Math.random() * (planeWidth - 10) - (planeWidth / 2 - 5);
        z = Math.random() * (planeHeight / 2) - (planeHeight / 2);
      
      tree.setAttribute("position", {
        x: x,
        y: -40,
        z: z
      });

      tree.setAttribute("rotation", `0 ${Math.random() * 360} 0`);
      tree.setAttribute("scale", "1 1 1");
      tree.setAttribute("gltf-model", randomModel);

      this.el.appendChild(tree);
    }
  }
});

  AFRAME.registerComponent("cursor-listener", {
    init: function () {
      let packs = document.getElementById("pack");
      let packs2 = document.getElementById("pack2");
      let thanks = document.getElementById("thanks");
      this.el.addEventListener("click", function () {
        if (packs) {
          packs.setAttribute("visible", "false");
          packs2.setAttribute("visible", "true");
          thanks.setAttribute("visible", "true");
        }
      });
    }
  })

  AFRAME.registerComponent("painting-listener", {
    init: function () {
      let paint = document.getElementById("paints");
      let soundEntity = this.el;
      this.el.addEventListener("click", function () {
        if (paint) {
          console.log("Clic d√©tect√© !");
          paint.setAttribute("visible", "false");
        }
      });
    }
  })

  AFRAME.registerComponent("paintingdelivered-listener", {
    init: function () {
      let paintingDelivered = document.getElementById("paintDelivered");
      let crow = document.getElementById("raven");
      let text = document.getElementById("croa");
      this.el.addEventListener("click", function () {
        if (crow) {
          console.log("Clic d√©tect√© !");
          paintingDelivered.setAttribute("visible", "true");
          text.setAttribute("visible", "true");
        }
      });
    }
  })

  AFRAME.registerComponent("bycicle-listener", {
    init: function () {
      let byciclette = document.getElementById("velo");
      let text = document.getElementById("afterBycicle");
      this.el.addEventListener("click", function () {
        if (byciclette) {
          console.log("Clic d√©tect√© !");
          byciclette.setAttribute("visible", "false");
          afterBycicle.setAttribute("visible", "true");
        }
      });
    }
  })

  document.addEventListener("click", () => {
  if (AFRAME.scenes[0].audioListener.context.state === "suspended") {
    AFRAME.scenes[0].audioListener.context.resume().then(() => {
      console.log("üîä Audio activ√© !");
    });
  }
}, { once: true }); // S‚Äôex√©cute une seule fois

AFRAME.registerComponent("click-sound", {
  init: function () {
    this.el.addEventListener("click", () => {
      let sound = this.el.components.sound;
      if (sound && sound.data && sound.data.src) {
        if (!sound.isPlaying) {
          console.log("üîä Lecture du son !");
          sound.playSound();
        }
      } else {
        console.warn("‚è≥ Son pas encore charg√©...");
      }
    });
  },
});


  </script>
</body>
</html>